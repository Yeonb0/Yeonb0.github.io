name: BOJ Auto Blog

on:
  push:
    branches: [ main ]

jobs:
  blog:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: Install dependency
      run: pip install PyGithub

    - name: Get changed files
      run: |
        git diff --name-only HEAD~1 HEAD > changed.txt

    - name: Generate posts
      env:
        BLOG_TOKEN: ${{ secrets.BLOG_TOKEN }}
      run: python BlogAction.py

    - name: Push to blog
      env:
        BLOG_TOKEN: ${{ secrets.BLOG_TOKEN }}
      run: |
        git clone https://$BLOG_TOKEN@github.com/Yeonb0/Yeonb0.github.io.git blog
        cp generated/*.md blog/_posts/ || true
        cd blog
        git config user.name "github-actions"
        git config user.email "actions@github.com"
        git add .
        git commit -m "Add BOJ solution post" || true
        git push
